@{
    ViewData["Title"] = "التقارير والإحصائيات";
    Layout = "_AdminLayout";
    var topProducts = ViewBag.TopProducts as IEnumerable<dynamic>;
}

<div class="page-title" style="margin-bottom:30px;">
    <h2 style="margin:0; color:var(--primary);">التقارير وتحليل المبيعات 📈</h2>
</div>

<!-- Stats Cards -->
<div style="display:grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap:20px; margin-bottom:40px;">
    <div class="card" style="border-right: 4px solid #10b981; padding:20px;">
        <p style="color:#666; margin:0 0 5px;">إجمالي المبيعات</p>
        <h2 style="margin:0; font-size:1.8rem; color:#10b981;">@(((decimal)ViewBag.TotalSales).ToString("N0")) <small>ج.م</small></h2>
    </div>
    <div class="card" style="border-right: 4px solid #3b82f6; padding:20px;">
        <p style="color:#666; margin:0 0 5px;">إجمالي الطلبات</p>
        <h2 style="margin:0; font-size:1.8rem; color:#3b82f6;">@ViewBag.TotalOrders</h2>
    </div>
    <div class="card" style="border-right: 4px solid #f59e0b; padding:20px;">
        <p style="color:#666; margin:0 0 5px;">طلبات معلقة</p>
        <h2 style="margin:0; font-size:1.8rem; color:#f59e0b;">@ViewBag.PendingOrders</h2>
    </div>
    <div class="card" style="border-right: 4px solid #6366f1; padding:20px;">
        <p style="color:#666; margin:0 0 5px;">طلبات مكتملة</p>
        <h2 style="margin:0; font-size:1.8rem; color:#6366f1;">@ViewBag.CompletedOrders</h2>
    </div>
</div>

<!-- Top Products Table -->
<div class="card">
    <h3 style="margin-top:0; margin-bottom:20px; border-bottom:1px solid #eee; padding-bottom:10px;">أكثر المنتجات مبيعاً</h3>
    @if (topProducts != null && topProducts.Any())
    {
        <table style="width:100%; border-collapse:collapse;">
            <thead style="background:#f8fafc;">
                <tr>
                    <th style="padding:10px; text-align:right;">اسم المنتج</th>
                    <th style="padding:10px; text-align:center;">الكمية المباعة</th>
                    <th style="padding:10px; text-align:left;">إجمالي الإيرادات</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in topProducts)
                {
                    <tr style="border-bottom:1px solid #eee;">
                        <td style="padding:10px; font-weight:bold;">@item.ProductName</td>
                        <td style="padding:10px; text-align:center;">@item.SoldQuantity</td>
                        <td style="padding:10px; text-align:left; color:#10b981;">@item.TotalRevenue.ToString("N0") ج.م</td>
                    </tr>
                }
            </tbody>
        </table>
    }
    else
    {
        <p style="text-align:center; color:#777; padding:20px;">لا توجد بيانات كافية لعرض التقرير.</p>
    }
</div>