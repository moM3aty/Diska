@model IEnumerable<Diska.Models.Order>
@{
    ViewData["Title"] = "لوحة القيادة";
    Layout = "_AdminLayout";
}

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<div class="page-title">
    <i class="fas fa-tachometer-alt" style="color: var(--primary);"></i> نظرة عامة
</div>

<!-- Stats Cards (نفس الكود السابق للبطاقات) -->
<div class="stats-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 20px; margin-bottom: 30px;">
    <!-- ... Cards code from previous batch ... -->
    <div class="card" style="border-right: 4px solid #10b981;">
        <p style="color: #666; margin:0;">مبيعات اليوم</p>
        <h2 style="margin:5px 0;">@ViewBag.DailySales.ToString("N0") <small>ج.م</small></h2>
    </div>
    <div class="card" style="border-right: 4px solid #f59e0b;">
        <p style="color: #666; margin:0;">طلبات معلقة</p>
        <h2 style="margin:5px 0;">@ViewBag.PendingOrders</h2>
    </div>
    <div class="card" style="border-right: 4px solid #3b82f6;">
        <p style="color: #666; margin:0;">عدد التجار</p>
        <h2 style="margin:5px 0;">@ViewBag.TotalMerchants</h2>
    </div>
    <div class="card" style="border-right: 4px solid #ef4444;">
        <p style="color: #666; margin:0;">نواقص المخزون</p>
        <h2 style="margin:5px 0;">@ViewBag.LowStockItems</h2>
    </div>
</div>

<!-- Charts Section (جديد) -->
<div style="display:grid; grid-template-columns: 2fr 1fr; gap:20px; margin-bottom:30px;">

    <!-- Sales Chart -->
    <div class="card">
        <h3 style="margin-top:0; color:var(--primary);">حركة المبيعات (آخر 7 أيام)</h3>
        <canvas id="salesChart" height="200"></canvas>
    </div>

    <!-- Order Status Chart -->
    <div class="card">
        <h3 style="margin-top:0; color:var(--primary);">حالات الطلبات</h3>
        <canvas id="statusChart" height="200"></canvas>
    </div>
</div>

<!-- Recent Orders Table -->
<div class="card">
    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
        <h3 style="margin:0;">أحدث الطلبات</h3>
        <a asp-action="Orders" class="btn btn-outline small">عرض الكل</a>
    </div>
    <table style="width:100%;">
        <thead>
            <tr style="background:#f9fafb;">
                <th>رقم الطلب</th>
                <th>العميل</th>
                <th>المبلغ</th>
                <th>الحالة</th>
                <th>الإجراء</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var order in Model)
            {
                <tr style="border-bottom:1px solid #eee;">
                    <td>#@order.Id</td>
                    <td>@order.CustomerName</td>
                    <td>@order.TotalAmount.ToString("N0")</td>
                    <td>
                        <span class="badge" style="background:@(order.Status == "Pending" ? "#fffbeb" : "#dcfce7"); color:@(order.Status == "Pending" ? "#d97706" : "#166534");">
                            @order.Status
                        </span>
                    </td>
                    <td><a asp-action="OrderDetails" asp-route-id="@order.Id" class="btn btn-outline small">تفاصيل</a></td>
                </tr>
            }
        </tbody>
    </table>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Sales Chart
        const ctxSales = document.getElementById('salesChart').getContext('2d');
        new Chart(ctxSales, {
            type: 'line',
            data: {
                labels: ['السبت', 'الأحد', 'الاثنين', 'الثلاثاء', 'الأربعاء', 'الخميس', 'الجمعة'],
                datasets: [{
                    label: 'المبيعات (ج.م)',
                    data: [12000, 19000, 3000, 5000, 20000, 30000, 45000], // داتا وهمية للعرض، يمكن ربطها بالكنترولر
                    borderColor: '#2563eb',
                    backgroundColor: 'rgba(37, 99, 235, 0.1)',
                    fill: true,
                    tension: 0.4
                }]
            },
            options: { responsive: true }
        });

        // Status Chart
        const ctxStatus = document.getElementById('statusChart').getContext('2d');
        new Chart(ctxStatus, {
            type: 'doughnut',
            data: {
                labels: ['معلق', 'مؤكد', 'مشحون', 'مكتمل'],
                datasets: [{
                    data: [@ViewBag.PendingOrders, 5, 3, 10], // داتا وهمية للعرض
                    backgroundColor: ['#f59e0b', '#3b82f6', '#7c3aed', '#10b981']
                }]
            },
            options: { responsive: true }
        });
    });
</script>