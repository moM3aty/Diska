@model IEnumerable<Diska.Areas.Admin.Controllers.UserViewModel>
@{
    ViewData["Title"] = "إدارة المستخدمين";
    Layout = "_AdminLayout";
}

<div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:25px;">
    <div>
        <h2 style="margin:0; color:var(--primary);">المستخدمين والصلاحيات</h2>
        <p style="color:#64748b; margin-top:5px;">إدارة العملاء، التجار، وفريق العمل</p>
    </div>

    <div class="btn-group">
        <a asp-action="Index" asp-route-role="All" class="btn btn-outline @(ViewBag.CurrentRole == "All" ? "active" : "")" style="border-radius:0 6px 6px 0;">الكل</a>
        <a asp-action="Index" asp-route-role="Merchant" class="btn btn-outline @(ViewBag.CurrentRole == "Merchant" ? "active" : "")" style="border-radius:0;">التجار</a>
        <a asp-action="Index" asp-route-role="Customer" class="btn btn-outline @(ViewBag.CurrentRole == "Customer" ? "active" : "")" style="border-radius:6px 0 0 6px;">العملاء</a>
    </div>
</div>

<div class="card">
    <table style="width:100%;">
        <thead>
            <tr>
                <th>البيانات</th>
                <th>الصلاحية</th>
                <th>المحفظة</th>
                <th>الحالة (للتجار)</th>
                <th>إجراءات</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var user in Model)
            {
                <tr>
                    <td>
                        <div style="display:flex; align-items:center; gap:10px;">
                            <div style="width:40px; height:40px; background:#f1f5f9; border-radius:50%; display:flex; align-items:center; justify-content:center; color:#64748b; font-weight:bold;">
                                @user.FullName?.FirstOrDefault()
                            </div>
                            <div>
                                <strong style="display:block; color:var(--text-dark);">@user.FullName</strong>
                                <small style="color:#64748b;">@user.PhoneNumber</small>
                                @if (!string.IsNullOrEmpty(user.ShopName))
                                {
                                    <br>
                            
                                    <small style="color:var(--primary);"><i class="fas fa-store"></i> @user.ShopName</small>
                                }
                            </div>
                        </div>
                    </td>
                    <td>
                        @if (user.Role == "Admin")
                        {
                            <span class="badge" style="background:#0f172a; color:#fff;">مسؤول (Admin)</span>
                        }
                        else if (user.Role == "Merchant")
                        {

                            <span class="badge" style="background:#7c3aed; color:#fff;">تاجر</span>
                        }
                        else
                        {

                            <span class="badge" style="background:#e2e8f0; color:#334155;">عميل</span>
                        }
                    </td>
                    <td>
                        <span style="font-weight:bold; color:@(user.WalletBalance > 0 ? "#16a34a" : "#334155")">
                            @user.WalletBalance.ToString("N0") <small>ج.م</small>
                        </span>
                    </td>
                    <td>
                        @if (user.Role == "Merchant")
                        {
                            if (user.IsVerified)
                            {
                                <span class="badge" style="background:#dcfce7; color:#166534;"><i class="fas fa-check-circle"></i> موثق</span>
                            }
                            else
                            {

                                <span class="badge" style="background:#fffbeb; color:#d97706;"><i class="fas fa-clock"></i> قيد المراجعة</span>
                            }
                        }
                        else
                        {
                            <span style="color:#ccc;">-</span>
                        }
                    </td>
                    <td>
                        <div style="display:flex; gap:5px;">
                            <a asp-action="Details" asp-route-id="@user.Id" class="btn btn-primary" style="padding:6px 12px; font-size:0.8rem;">
                                التفاصيل
                            </a>

                            @if (user.Role == "Merchant")
                            {
                                <form asp-action="ToggleVerification" method="post" style="display:inline;">
                                    <input type="hidden" name="id" value="@user.Id" />
                                    <button type="submit" class="btn btn-outline" style="padding:6px 12px; font-size:0.8rem;" title="@(user.IsVerified ? "إلغاء التوثيق" : "توثيق")">
                                        <i class="fas @(user.IsVerified ? "fa-ban" : "fa-check")"></i>
                                    </button>
                                </form>
                            }

                            <form asp-action="Delete" method="post" style="display:inline;" data-confirm="هل أنت متأكد من حذف المستخدم @user.FullName نهائياً؟">
                                <input type="hidden" name="id" value="@user.Id" />
                                <button type="submit" class="btn btn-danger" style="padding:6px 12px; font-size:0.8rem; background:#fee2e2; color:#dc2626; border:none;">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </form>
                        </div>
                    </td>
                </tr>
            }
        </tbody>
    </table>
</div>