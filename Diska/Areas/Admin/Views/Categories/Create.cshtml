@model Diska.Models.Category
@{
    ViewData["Title"] = "إضافة قسم";
    Layout = "_AdminLayout";
}

<style>
    .icon-grid {
        display: grid; grid-template-columns: repeat(auto-fill, minmax(60px, 1fr)); gap: 10px;
        max-height: 250px; overflow-y: auto; padding: 15px; background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 12px;
    }
    .icon-option {
        height: 50px; display: flex; align-items: center; justify-content: center; background: #fff;
        border: 1px solid #e2e8f0; border-radius: 10px; cursor: pointer; font-size: 1.3rem; color: #64748b; transition: all 0.2s ease;
    }
    .icon-option:hover { border-color: var(--primary); color: var(--primary); transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.05); }
    .icon-option.active { background: var(--primary); color: #fff; border-color: var(--primary); box-shadow: 0 4px 10px rgba(79, 70, 229, 0.3); }

    .selected-icon-preview {
        width: 90px; height: 90px; background: linear-gradient(135deg, #eff6ff 0%, #e0e7ff 100%);
        color: var(--primary); border-radius: 50%;
        display: flex; align-items: center; justify-content: center; font-size: 2.5rem; margin: 0 auto 15px;
        box-shadow: 0 10px 25px rgba(79, 70, 229, 0.15); border: 4px solid #fff;
    }
</style>

<div class="row justify-content-center fade-up">
    <div class="col-md-8">
        <div class="card border-0 shadow-sm" style="border-radius: 16px;">
            <div class="card-header bg-white py-3 border-bottom d-flex justify-content-between align-items-center">
                <h5 class="mb-0 text-primary fw-bold">إضافة قسم جديد</h5>
                <a asp-action="Index" class="btn btn-sm btn-light border fw-bold text-muted">إلغاء</a>
            </div>

            <div class="card-body p-4">
                <form asp-action="Create">
                    <div asp-validation-summary="ModelOnly" class="text-danger mb-3"></div>

                    <!-- Icon Preview -->
                    <div class="text-center mb-4">
                        <div class="selected-icon-preview">
                            <i id="previewIcon" class="fas fa-folder"></i>
                        </div>
                        <p class="text-muted small fw-bold">اختر أيقونة للقسم</p>
                    </div>

                    <div class="row g-3">
                        <!-- Names -->
                        <div class="col-md-6">
                            <label class="form-label fw-bold small text-muted">الاسم (عربي)</label>
                            <input asp-for="Name" class="form-control" required placeholder="مثال: إلكترونيات" />
                        </div>
                        <div class="col-md-6">
                            <label class="form-label fw-bold small text-muted">الاسم (إنجليزي)</label>
                            <input asp-for="NameEn" class="form-control" placeholder="Electronics" />
                        </div>

                        <!-- Parent Category -->
                        <div class="col-md-12">
                            <label class="form-label fw-bold small text-muted">القسم الرئيسي (Parent)</label>
                            <select asp-for="ParentId" class="form-select" asp-items="ViewBag.Parents">
                                <option value="">-- هذا قسم رئيسي --</option>
                            </select>
                        </div>

                        <!-- Icon Picker -->
                        <div class="col-12">
                            <label class="form-label fw-bold small text-muted">قائمة الأيقونات (ابحث واختر)</label>
                            <!-- Search Icons (Optional simple filter) -->
                            <input type="text" id="iconSearch" class="form-control mb-2 form-control-sm" placeholder="ابحث عن أيقونة (مثال: car, home)..." onkeyup="filterIcons()">

                            <input type="hidden" asp-for="IconClass" id="IconClassInput" value="fas fa-folder">
                            <div class="icon-grid" id="iconGrid"></div>
                        </div>

                        <!-- Other Fields -->
                        <div class="col-md-6">
                            <label class="form-label fw-bold small text-muted">Slug (رابط)</label>
                            <input asp-for="Slug" class="form-control bg-light" placeholder="يتم توليده تلقائياً" />
                        </div>
                        <div class="col-md-3">
                            <label class="form-label fw-bold small text-muted">الترتيب</label>
                            <input asp-for="DisplayOrder" type="number" class="form-control" value="0" />
                        </div>
                        <div class="col-md-3">
                            <label class="form-label fw-bold small text-muted">الحالة</label>
                            <select asp-for="IsActive" class="form-select">
                                <option value="true">نشط</option>
                                <option value="false">مخفي</option>
                            </select>
                        </div>

                        <div class="col-12">
                            <hr class="text-muted opacity-25">
                            <label class="form-label fw-bold small text-muted">وصف الميتا (SEO)</label>
                            <textarea asp-for="MetaDescription" class="form-control" rows="2"></textarea>
                        </div>
                    </div>

                    <div class="mt-4 pt-3 border-top text-end">
                        <button type="submit" class="btn btn-primary px-4 fw-bold shadow-sm">حفظ القسم</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        // Expanded Icon List
        const icons = [
            // General & UI
            'fas fa-folder', 'fas fa-home', 'fas fa-bars', 'fas fa-star', 'fas fa-heart', 'fas fa-check',
            'fas fa-cog', 'fas fa-user', 'fas fa-users', 'fas fa-search', 'fas fa-bell', 'fas fa-map-marker-alt',

            // Electronics & Gadgets
            'fas fa-laptop', 'fas fa-desktop', 'fas fa-mobile-alt', 'fas fa-tablet-alt', 'fas fa-tv',
            'fas fa-camera', 'fas fa-video', 'fas fa-headphones', 'fas fa-microphone', 'fas fa-print',
            'fas fa-plug', 'fas fa-battery-full', 'fas fa-microchip', 'fas fa-gamepad', 'fas fa-wifi',
            'fas fa-server', 'fas fa-mouse', 'fas fa-keyboard', 'fas fa-hdd', 'fas fa-sd-card', 'fas fa-sim-card',

            // Fashion & Clothing
            'fas fa-tshirt', 'fas fa-user-tie', 'fas fa-socks', 'fas fa-hat-cowboy', 'fas fa-hat-wizard',
            'fas fa-glasses', 'fas fa-ring', 'fas fa-gem', 'fas fa-vest', 'fas fa-shopping-bag',
            'fas fa-shoe-prints', 'fas fa-mask', 'fas fa-mitten', 'fas fa-stopwatch',

            // Home, Furniture & Decor
            'fas fa-couch', 'fas fa-bed', 'fas fa-chair', 'fas fa-door-open', 'fas fa-door-closed',
            'fas fa-bath', 'fas fa-shower', 'fas fa-toilet', 'fas fa-soap', 'fas fa-lightbulb',
            'fas fa-fan', 'fas fa-blender', 'fas fa-utensils', 'fas fa-mug-hot', 'fas fa-glass-martini-alt',
            'fas fa-box-open', 'fas fa-box', 'fas fa-seedling', 'fas fa-leaf', 'fas fa-fire',

            // Grocery & Food
            'fas fa-shopping-basket', 'fas fa-cart-plus', 'fas fa-carrot', 'fas fa-apple-alt', 'fas fa-lemon',
            'fas fa-pepper-hot', 'fas fa-pizza-slice', 'fas fa-hamburger', 'fas fa-hotdog', 'fas fa-drumstick-bite',
            'fas fa-fish', 'fas fa-egg', 'fas fa-cheese', 'fas fa-bread-slice', 'fas fa-ice-cream',
            'fas fa-cookie', 'fas fa-candy-cane', 'fas fa-coffee', 'fas fa-wine-bottle', 'fas fa-beer',

            // Health, Beauty & Medical
            'fas fa-heartbeat', 'fas fa-stethoscope', 'fas fa-pills', 'fas fa-first-aid', 'fas fa-syringe',
            'fas fa-thermometer', 'fas fa-eye', 'fas fa-tooth', 'fas fa-hand-holding-medical', 'fas fa-hospital',
            'fas fa-spa', 'fas fa-cut', 'fas fa-spray-can', 'fas fa-pump-soap', 'fas fa-hand-sparkles',

            // Sports & Fitness
            'fas fa-dumbbell', 'fas fa-bicycle', 'fas fa-futbol', 'fas fa-basketball-ball', 'fas fa-volleyball-ball',
            'fas fa-football-ball', 'fas fa-golf-ball', 'fas fa-table-tennis', 'fas fa-running', 'fas fa-swimmer',
            'fas fa-skating', 'fas fa-skiing', 'fas fa-snowboarding', 'fas fa-medal', 'fas fa-trophy',

            // Automotive & Tools
            'fas fa-car', 'fas fa-motorcycle', 'fas fa-truck', 'fas fa-bus', 'fas fa-taxi',
            'fas fa-gas-pump', 'fas fa-oil-can', 'fas fa-tools', 'fas fa-wrench', 'fas fa-hammer',
            'fas fa-screwdriver', 'fas fa-paint-roller', 'fas fa-brush', 'fas fa-ruler-combined', 'fas fa-tachometer-alt',

            // Kids & Toys
            'fas fa-baby', 'fas fa-baby-carriage', 'fas fa-shapes', 'fas fa-puzzle-piece', 'fas fa-robot',
            'fas fa-gamepad', 'fas fa-ghost', 'fas fa-dice', 'fas fa-chess-knight', 'fas fa-bicycle',

            // Office & School
            'fas fa-book', 'fas fa-pen', 'fas fa-pencil-alt', 'fas fa-eraser', 'fas fa-paperclip',
            'fas fa-briefcase', 'fas fa-calculator', 'fas fa-calendar-alt', 'fas fa-envelope', 'fas fa-folder-open',

            // Gifts & Occasions
            'fas fa-gift', 'fas fa-birthday-cake', 'fas fa-ribbon', 'fas fa-tags', 'fas fa-ticket-alt'
        ];

        const grid = document.getElementById('iconGrid');
        const input = document.getElementById('IconClassInput');
        const preview = document.getElementById('previewIcon');

        // Function to render icons
        function renderIcons(filter = "") {
            grid.innerHTML = "";
            const current = input.value;

            icons.forEach(iconClass => {
                if (filter && !iconClass.includes(filter)) return;

                const div = document.createElement('div');
                div.className = 'icon-option';
                if (current === iconClass) div.classList.add('active');

                div.innerHTML = `<i class="${iconClass}"></i>`;
                div.title = iconClass; // Tooltip

                div.onclick = function() {
                    document.querySelectorAll('.icon-option').forEach(el => el.classList.remove('active'));
                    this.classList.add('active');
                    input.value = iconClass;
                    preview.className = iconClass;
                };

                grid.appendChild(div);
            });
        }

        // Search Filter
        function filterIcons() {
            const val = document.getElementById('iconSearch').value.toLowerCase();
            renderIcons(val);
        }

        // Init
        renderIcons();
    </script>
}