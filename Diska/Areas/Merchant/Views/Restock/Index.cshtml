@model IEnumerable<Diska.Models.RestockSubscription>
@using System.Globalization
@{
    ViewData["Title"] = "نواقص المخزون";
    Layout = "_MerchantLayout";
    bool isAr = CultureInfo.CurrentCulture.Name.StartsWith("ar");
}

<div class="d-flex justify-content-between align-items-center mb-4">
    <div>
        <h2 class="fw-bold mb-1" style="color:var(--text-main)">طلبات توفير المنتج</h2>
        <p class="text-muted small mb-0">عملاء ينتظرون توفر منتجاتك النافذة</p>
    </div>
</div>

<style>
    .restock-card {
        background: var(--bg-card);
        border: 1px solid var(--border-color);
        border-radius: 16px;
        box-shadow: var(--shadow-sm);
    }

    .prod-icon {
        width: 45px;
        height: 45px;
        border-radius: 10px;
        background: var(--bg-body);
        border: 1px solid var(--border-color);
        padding: 2px;
        object-fit: contain;
    }

    .user-avatar-sm {
        width: 30px;
        height: 30px;
        background: #e0f2fe;
        color: #0284c7;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        font-size: 0.8rem;
    }
</style>

@if (!Model.Any())
{
    <div class="text-center py-5 rounded-4 border border-dashed" style="border-color: var(--border-color)!important;">
        <div class="text-muted opacity-25 mb-3"><i class="fas fa-bell-slash fa-4x"></i></div>
        <h4 class="text-muted">لا توجد طلبات انتظار</h4>
        <p class="text-muted small">جميع منتجاتك متوفرة أو لا يوجد عملاء في قائمة الانتظار.</p>
    </div>
}
else
{
    <div class="restock-card overflow-hidden">
        <div class="table-responsive">
            <table class="table align-middle mb-0" style="color:var(--text-main)">
                <thead style="background:rgba(0,0,0,0.02); border-bottom:1px solid var(--border-color);">
                    <tr>
                        <th class="ps-4 py-3 text-muted text-uppercase small fw-bold">المنتج</th>
                        <th class="text-muted text-uppercase small fw-bold">تاريخ الطلب</th>
                        <th class="text-end pe-4 text-muted text-uppercase small fw-bold">إجراء</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var item in Model)
                    {
                        <tr style="border-bottom:1px solid var(--border-color);">
                            <td class="ps-4 py-3">
                                <div class="d-flex align-items-center gap-3">
                                    <img src="~/@item.Product?.ImageUrl" class="prod-icon" onerror="this.src='/images/default.png'">
                                    <div>
                                        <div class="fw-bold">@item.Product?.Name</div>
                                        @if (item.Product?.StockQuantity == 0)
                                        {
                                            <span class="badge bg-danger bg-opacity-10 text-danger border border-danger border-opacity-25" style="font-size:0.65rem">نافذ (0)</span>
                                        }
                                        else
                                        {
                                            <span class="badge bg-success bg-opacity-10 text-success border border-success border-opacity-25" style="font-size:0.65rem">توفر (@item.Product.StockQuantity)</span>
                                        }
                                    </div>
                                </div>
                            </td>
                            
                            <td class="text-muted small">@item.RequestDate.ToString("yyyy-MM-dd")</td>
                            <td class="text-end pe-4">
                                <a href="/Merchant/Product/Edit/@item.ProductId" class="btn btn-sm btn-primary fw-bold px-3 rounded-pill">
                                    <i class="fas fa-plus-circle me-1"></i> تحديث المخزون
                                </a>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>
}