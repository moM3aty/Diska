@model Diska.Models.Order
@using System.Globalization
@{
    bool isAr = CultureInfo.CurrentCulture.Name.StartsWith("ar");
    ViewData["Title"] = isAr ? "تتبع الطلب" : "Track Order";

    // تحديد الخطوة الحالية بناءً على الحالة
    int step = 0;
    if (Model.Status == "Pending") step = 1;
    else if (Model.Status == "Confirmed") step = 2;
    else if (Model.Status == "Shipped") step = 3;
    else if (Model.Status == "Delivered") step = 4;
    else if (Model.Status == "Cancelled") step = 0; // حالة خاصة
}

<section class="section-padding">
    <div class="container">
        <div class="track-card" style="background:#fff; padding:40px; border-radius:15px; border:1px solid #eee; max-width:800px; margin:0 auto;">

            <div style="text-align:center; margin-bottom:40px;">
                <h2 style="color:var(--primary);">@(isAr ? $"تتبع الطلب #{Model.Id}" : $"Track Order #{Model.Id}")</h2>
                <p style="color:#666;">@(isAr ? "التاريخ المتوقع للتوصيل: خلال 2-4 أيام عمل" : "Expected Delivery: 2-4 Business Days")</p>
                @if (Model.Status == "Cancelled")
                {
                    <div class="badge" style="background:#fee2e2; color:#dc2626; font-size:1rem; padding:10px 20px; margin-top:10px;">
                        @(isAr ? "تم إلغاء هذا الطلب" : "Order Cancelled")
                    </div>
                }
            </div>

            @if (Model.Status != "Cancelled")
            {
                <div class="progress-track" style="display:flex; justify-content:space-between; position:relative; margin-bottom:50px;">
                    <!-- Line -->
                    <div style="position:absolute; top:15px; left:0; width:100%; height:4px; background:#f1f5f9; z-index:0;"></div>
                    <div style="position:absolute; top:15px; left:0; width:@((step - 1) * 33)%; height:4px; background:var(--success); z-index:0; transition: width 0.5s;"></div>

                    <!-- Steps -->
                    <div class="step-item @(step >= 1 ? "active" : "")" style="position:relative; z-index:1; text-align:center; flex:1;">
                        <div class="step-icon" style="width:35px; height:35px; background:@(step >= 1 ? "var(--success)" : "#f1f5f9"); color:@(step >= 1 ? "#fff" : "#ccc"); border-radius:50%; display:flex; align-items:center; justify-content:center; margin:0 auto 10px; font-weight:bold;">
                            <i class="fas fa-file-alt"></i>
                        </div>
                        <span style="font-size:0.9rem; font-weight:bold; color:@(step >= 1 ? "var(--primary)" : "#ccc");">@(isAr ? "تم الاستلام" : "Received")</span>
                    </div>

                    <div class="step-item @(step >= 2 ? "active" : "")" style="position:relative; z-index:1; text-align:center; flex:1;">
                        <div class="step-icon" style="width:35px; height:35px; background:@(step >= 2 ? "var(--success)" : "#f1f5f9"); color:@(step >= 2 ? "#fff" : "#ccc"); border-radius:50%; display:flex; align-items:center; justify-content:center; margin:0 auto 10px; font-weight:bold;">
                            <i class="fas fa-box-open"></i>
                        </div>
                        <span style="font-size:0.9rem; font-weight:bold; color:@(step >= 2 ? "var(--primary)" : "#ccc");">@(isAr ? "تم التأكيد" : "Confirmed")</span>
                    </div>

                    <div class="step-item @(step >= 3 ? "active" : "")" style="position:relative; z-index:1; text-align:center; flex:1;">
                        <div class="step-icon" style="width:35px; height:35px; background:@(step >= 3 ? "var(--success)" : "#f1f5f9"); color:@(step >= 3 ? "#fff" : "#ccc"); border-radius:50%; display:flex; align-items:center; justify-content:center; margin:0 auto 10px; font-weight:bold;">
                            <i class="fas fa-truck"></i>
                        </div>
                        <span style="font-size:0.9rem; font-weight:bold; color:@(step >= 3 ? "var(--primary)" : "#ccc");">@(isAr ? "جاري الشحن" : "Shipping")</span>
                    </div>

                    <div class="step-item @(step >= 4 ? "active" : "")" style="position:relative; z-index:1; text-align:center; flex:1;">
                        <div class="step-icon" style="width:35px; height:35px; background:@(step >= 4 ? "var(--success)" : "#f1f5f9"); color:@(step >= 4 ? "#fff" : "#ccc"); border-radius:50%; display:flex; align-items:center; justify-content:center; margin:0 auto 10px; font-weight:bold;">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <span style="font-size:0.9rem; font-weight:bold; color:@(step >= 4 ? "var(--primary)" : "#ccc");">@(isAr ? "تم التسليم" : "Delivered")</span>
                    </div>
                </div>
            }

            <div style="background:#f8fafc; padding:20px; border-radius:10px; display:flex; justify-content:space-between; flex-wrap:wrap; gap:20px;">
                <div>
                    <h4 style="margin:0 0 10px; color:var(--primary);">@(isAr ? "عنوان التوصيل" : "Delivery Address")</h4>
                    <p style="margin:0; color:#555;">@Model.Governorate, @Model.City</p>
                    <p style="margin:0; color:#555;">@Model.Address</p>
                </div>
                <div>
                    <h4 style="margin:0 0 10px; color:var(--primary);">@(isAr ? "تفاصيل الدفع" : "Payment Details")</h4>
                    <p style="margin:0; color:#555;">@(isAr ? "طريقة الدفع:" : "Method:") @Model.PaymentMethod</p>
                    <p style="margin:0; color:#555; font-weight:bold;">@(isAr ? "الإجمالي:" : "Total:") @Model.TotalAmount.ToString("N2")</p>
                </div>
            </div>

            <div style="text-align:center; margin-top:30px;">
                <a asp-action="Details" asp-route-id="@Model.Id" class="btn btn-outline">@(isAr ? "عرض التفاصيل الكاملة" : "View Full Details")</a>
                <a asp-action="MyOrders" class="btn" style="color:#666;">@(isAr ? "العودة للقائمة" : "Back to List")</a>
            </div>

        </div>
    </div>
</section>