@model Diska.Models.Order
@using System.Globalization
@{
    bool isAr = CultureInfo.CurrentCulture.Name.StartsWith("ar");
    ViewData["Title"] = isAr ? $"تفاصيل الطلب #{Model.Id}" : $"Order Details #{Model.Id}";
}

<section class="section-padding">
    <div class="container">

        <!-- Breadcrumb -->
        <div class="breadcrumb">
            <a asp-controller="Home" asp-action="Index">@(isAr ? "الرئيسية" : "Home")</a> /
            <a asp-action="MyOrders">@(isAr ? "طلباتي" : "My Orders")</a> /
            <span>#@Model.Id</span>
        </div>

        <div class="order-details-box" style="background:#fff; border-radius:10px; border:1px solid #eee; overflow:hidden;">

            <!-- Header -->
            <div class="od-header" style="background:var(--bg-light); padding:20px; border-bottom:1px solid #eee; display:flex; justify-content:space-between; align-items:center;">
                <div>
                    <h2 style="margin:0; font-size:1.2rem; color:var(--primary);">@(isAr ? $"طلب رقم #{Model.Id}" : $"Order #{Model.Id}")</h2>
                    <span style="font-size:0.9rem; color:#666;">@Model.OrderDate.ToString("dd/MM/yyyy hh:mm tt")</span>
                </div>
                @{
                    var statusClass = Model.Status == "Pending" ? "bg-warning" : (Model.Status == "Confirmed" ? "bg-info" : "bg-success");
                    var statusText = isAr ? (Model.Status == "Pending" ? "قيد الانتظار" : (Model.Status == "Confirmed" ? "مؤكد" : "تم الشحن")) : Model.Status;
                }
                <span class="badge @statusClass" style="font-size:0.9rem; padding:8px 15px; color:#fff; background-color:@(Model.Status == "Pending" ? "#f59e0b" : "#10b981")">@statusText</span>
            </div>

            <!-- Body -->
            <div class="od-body" style="padding:20px;">

                <!-- Items Table -->
                <table style="width:100%; border-collapse:collapse; margin-bottom:30px;">
                    <thead>
                        <tr style="border-bottom:2px solid #eee; text-align:inherit;">
                            <th style="padding:10px;">@(isAr ? "المنتج" : "Product")</th>
                            <th style="padding:10px;">@(isAr ? "الكمية" : "Qty")</th>
                            <th style="padding:10px;">@(isAr ? "السعر" : "Price")</th>
                            <th style="padding:10px;">@(isAr ? "الإجمالي" : "Total")</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var item in Model.OrderItems)
                        {
                            <tr style="border-bottom:1px solid #f9f9f9;">
                                <td style="padding:15px 10px; display:flex; align-items:center; gap:10px;">
                                    <img src="~/@(item.Product?.ImageUrl ?? "images/default.png")" style="width:50px; height:50px; object-fit:contain; border-radius:5px; border:1px solid #eee;">
                                    <div>
                                        <div style="font-weight:bold;">@(isAr? item.Product?.Name : (item.Product?.NameEn ?? item.Product?.Name))</div>
                                    </div>
                                </td>
                                <td style="padding:10px;">x @item.Quantity</td>
                                <td style="padding:10px;">@item.UnitPrice.ToString("N2")</td>
                                <td style="padding:10px; font-weight:bold;">@((item.UnitPrice * item.Quantity).ToString("N2"))</td>
                            </tr>
                        }
                    </tbody>
                </table>

                <div style="display:grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap:30px; margin-top:20px;">

                    <!-- Address Info -->
                    <div style="background:#f8fafc; padding:20px; border-radius:10px;">
                        <h4 style="margin-bottom:15px; color:var(--primary);">@(isAr ? "عنوان التوصيل" : "Delivery Address")</h4>
                        <p style="margin:5px 0; color:#555;"><strong>@(isAr ? "الاسم:" : "Name:")</strong> @Model.CustomerName</p>
                        <p style="margin:5px 0; color:#555;"><strong>@(isAr ? "الهاتف:" : "Phone:")</strong> @Model.Phone</p>
                        <p style="margin:5px 0; color:#555;"><strong>@(isAr ? "العنوان:" : "Address:")</strong> @Model.Governorate, @Model.City, @Model.Address</p>
                    </div>

                    <!-- Payment Summary -->
                    <div style="background:#f8fafc; padding:20px; border-radius:10px;">
                        <h4 style="margin-bottom:15px; color:var(--primary);">@(isAr ? "ملخص الدفع" : "Payment Summary")</h4>
                        <div style="display:flex; justify-content:space-between; margin-bottom:10px;">
                            <span>@(isAr ? "طريقة الدفع" : "Method")</span>
                            <strong>@Model.PaymentMethod</strong>
                        </div>
                        <div style="display:flex; justify-content:space-between; margin-bottom:10px;">
                            <span>@(isAr ? "المجموع" : "Subtotal")</span>
                            <span>@Model.TotalAmount.ToString("N2") @(isAr ? "ج.م" : "EGP")</span>
                        </div>
                        <hr>
                        <div style="display:flex; justify-content:space-between; margin-top:10px; font-size:1.2rem; color:var(--primary);">
                            <strong>@(isAr ? "الإجمالي الكلي" : "Grand Total")</strong>
                            <strong>@Model.TotalAmount.ToString("N2") @(isAr ? "ج.م" : "EGP")</strong>
                        </div>
                    </div>

                </div>

            </div>

            <div class="od-footer" style="padding:20px; text-align:center; border-top:1px solid #eee;">
                <a asp-action="MyOrders" class="btn btn-outline" style="border:1px solid #ccc; color:#333; padding:10px 20px; border-radius:5px; text-decoration:none;">@(isAr ? "عودة للقائمة" : "Back to List")</a>
                <button class="btn primary" onclick="window.print()" style="margin:0 10px;">@(isAr ? "طباعة الفاتورة" : "Print Invoice") <i class="fas fa-print"></i></button>
            </div>

        </div>
    </div>
</section>