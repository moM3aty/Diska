@model Diska.Models.Order
@using System.Globalization
@{
    bool isAr = CultureInfo.CurrentCulture.Name.StartsWith("ar");
    ViewData["Title"] = isAr ? "تفاصيل الطلب" : "Order Details";
    Layout = "_Layout";

    // تحديد حالة التتبع
    int step = 0;
    if (Model.Status == "Pending") { step = 1; }
    else if (Model.Status == "Confirmed") { step = 2; }
    else if (Model.Status == "Shipped") { step = 3; }
    else if (Model.Status == "Delivered") { step = 4; }
}

<section class="section-padding" style="background-color: #f9fafb;">
    <div class="container">

        <div class="breadcrumb" style="margin-bottom:20px;">
            <a asp-action="Index">@(isAr ? "سجل الطلبات" : "Order History")</a> / <span>#@Model.Id</span>
        </div>

        <div class="order-summary-box new-design" style="margin-top:0; padding:0; overflow:hidden;">

            <div style="padding:20px; border-bottom:1px solid #eee; background:#fff;">
                <h3 style="margin:0; color:var(--primary);">@(isAr ? "تفاصيل الطلب" : "Order Details") #@Model.Id</h3>
                <span style="color:#666; font-size:0.9rem;">@Model.OrderDate.ToString("dd MMMM yyyy, hh:mm tt")</span>
            </div>

            <!-- Tracking Bar (Custom Style for Client) -->
            @if (Model.Status != "Cancelled")
            {
                <div style="padding:30px 20px; background:#fff; border-bottom:1px solid #eee;">
                    <div style="display:flex; justify-content:space-between; position:relative; max-width:500px; margin:0 auto;">
                        <div style="position:absolute; top:12px; left:0; width:100%; height:3px; background:#e2e8f0; z-index:0;"></div>
                        <div style="position:absolute; top:12px; left:0; width:@((step - 1) * 33)%; height:3px; background:var(--success); z-index:0; transition:width 0.5s;"></div>

                        <div style="z-index:1; text-align:center;">
                            <div style="width:25px; height:25px; background:@(step >= 1 ? "var(--success)" : "#e2e8f0"); border-radius:50%; margin:0 auto 5px; color:#fff; display:flex; align-items:center; justify-content:center; font-size:0.7rem;"><i class="fas fa-check"></i></div>
                            <span style="font-size:0.8rem; color:@(step >= 1 ? "#000" : "#999")">@(isAr ? "تم الطلب" : "Placed")</span>
                        </div>
                        <div style="z-index:1; text-align:center;">
                            <div style="width:25px; height:25px; background:@(step >= 2 ? "var(--success)" : "#e2e8f0"); border-radius:50%; margin:0 auto 5px; color:#fff; display:flex; align-items:center; justify-content:center; font-size:0.7rem;"><i class="fas fa-box"></i></div>
                            <span style="font-size:0.8rem; color:@(step >= 2 ? "#000" : "#999")">@(isAr ? "مؤكد" : "Confirmed")</span>
                        </div>
                        <div style="z-index:1; text-align:center;">
                            <div style="width:25px; height:25px; background:@(step >= 3 ? "var(--success)" : "#e2e8f0"); border-radius:50%; margin:0 auto 5px; color:#fff; display:flex; align-items:center; justify-content:center; font-size:0.7rem;"><i class="fas fa-truck"></i></div>
                            <span style="font-size:0.8rem; color:@(step >= 3 ? "#000" : "#999")">@(isAr ? "مشحون" : "Shipped")</span>
                        </div>
                        <div style="z-index:1; text-align:center;">
                            <div style="width:25px; height:25px; background:@(step >= 4 ? "var(--success)" : "#e2e8f0"); border-radius:50%; margin:0 auto 5px; color:#fff; display:flex; align-items:center; justify-content:center; font-size:0.7rem;"><i class="fas fa-home"></i></div>
                            <span style="font-size:0.8rem; color:@(step >= 4 ? "#000" : "#999")">@(isAr ? "مستلم" : "Delivered")</span>
                        </div>
                    </div>
                </div>
            }
            else
            {
                <div style="padding:20px; background:#fee2e2; color:#dc2626; text-align:center; font-weight:bold;">
                    <i class="fas fa-times-circle"></i> @(isAr ? "هذا الطلب ملغي" : "This order is cancelled")
                </div>
            }

            <div class="checkout-items" style="max-height:none; padding:20px; background:#fff;">
                @foreach (var item in Model.OrderItems)
                {
                    <div class="c-item" style="border-bottom:1px solid #f5f5f5; padding-bottom:15px; margin-bottom:15px;">
                        <img src="~/@item.Product?.ImageUrl" onerror="this.src='/images/default.png'" style="width:60px; height:60px; object-fit:contain; border:1px solid #eee; border-radius:8px;">
                        <div>
                            <h4 style="font-size:1rem; margin-bottom:5px;">@(isAr? item.Product?.Name : item.Product?.NameEn)</h4>
                            <small style="color:#666;">@(isAr ? "الكمية" : "Qty"): <strong>@item.Quantity</strong> x @item.UnitPrice.ToString("N0")</small>
                        </div>
                        <span style="font-weight:bold; color:var(--primary);">@((item.Quantity * item.UnitPrice).ToString("N0"))</span>
                    </div>
                }
            </div>

            <div style="background:#f9f9f9; padding:20px; border-top:1px solid #eee;">
                <div class="cost-row">
                    <span>@(isAr ? "عنوان التوصيل" : "Shipping Address")</span>
                    <strong style="max-width:250px; text-align:@(isAr ? "left" : "right");">@Model.Governorate, @Model.City - @Model.Address</strong>
                </div>
                <div class="cost-row">
                    <span>@(isAr ? "طريقة الدفع" : "Payment Method")</span>
                    <strong>@(Model.PaymentMethod == "Cash" ? (isAr ? "دفع عند الاستلام" : "Cash") : (isAr ? "محفظة" : "Wallet"))</strong>
                </div>

                <div class="summary-divider"></div>

                <div class="cost-row">
                    <span>@(isAr ? "الشحن" : "Shipping")</span>
                    <span>@Model.ShippingCost.ToString("N0")</span>
                </div>
                <div class="total-row" style="font-size:1.4rem;">
                    <span>@(isAr ? "الإجمالي" : "Total")</span>
                    <span>@Model.TotalAmount.ToString("N0") <small>@(isAr ? "ج.م" : "EGP")</small></span>
                </div>
            </div>
        </div>

    </div>
</section>