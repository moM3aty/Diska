@model IEnumerable<Diska.Models.Product>
@using System.Globalization
@{
    bool isAr = CultureInfo.CurrentCulture.Name.StartsWith("ar");
    ViewData["Title"] = isAr ? "الرئيسية" : "Home";

    // الأقسام من قاعدة البيانات
    var categories = ViewBag.Categories as IEnumerable<Diska.Models.Category>;

    // ألوان للأيقونات (تجميلي)
    string[] iconColors = { "#e0f2fe", "#fef3c7", "#dcfce7", "#fee2e2", "#f3e8ff", "#ffedd5" };
    string[] textColors = { "#0284c7", "#d97706", "#16a34a", "#dc2626", "#9333ea", "#ea580c" };
}

<!-- 1. Hero Section -->
<section class="hero-section">
    <div class="container">
        <div class="banner-card">
            <div class="banner-content">
                <div class="tag-box">
                    <span class="tag">@(isAr ? "عروض متتفوتش 🔥" : "Hot Deals 🔥")</span>
                </div>
                <h2 class="main-headline">@(isAr ? "خصومات حصرية على جميع المنتجات" : "Exclusive Discounts on All Products")</h2>
                <p class="slogan-desc">
                    @(isAr ? "Diska — التجارة بقت هنا. أسهل طريقة لطلب بضاعة محلك من المصنع مباشرة." : "Diska — Trade is here. The easiest way to order stock directly from factories.")
                </p>
                <a asp-action="Deals" class="btn primary">@(isAr ? "تصفح العروض" : "Shop Deals")</a>
            </div>
            <div class="banner-image">
                <!-- صورة البنر -->
                <img src="~/images/banner-img.png" alt="Groceries" onerror="this.src='https://placehold.co/400x300?text=Offers'">
            </div>
        </div>
    </div>
</section>

<!-- 2. Categories Section -->
@if (categories != null && categories.Any())
{
    <section class="categories-section">
        <div class="container">
            <div class="section-header">
                <h3>@(isAr ? "تسوق حسب القسم" : "Shop by Category")</h3>
            </div>
            <div class="categories-grid">
                @{
                    int i = 0;
                }
                @foreach (var cat in categories)
                {
                    var bg = iconColors[i % iconColors.Length];
                    var color = textColors[i % textColors.Length];
                    i++;

                    <a asp-controller="Product" asp-action="Category" asp-route-id="@cat.Id" class="cat-item">
                        <div class="icon" style="background-color: @bg; color: @color;">
                            <i class="@cat.IconClass"></i>
                        </div>
                        <span>@(isAr? cat.Name: (cat.NameEn ?? cat.Name))</span>
                    </a>
                }
                <!-- رابط الصفقات -->
                <a asp-controller="Home" asp-action="Deals" class="cat-item">
                    <div class="icon" style="background-color: #ffedd5; color: #ea580c;">
                        <i class="fas fa-fire"></i>
                    </div>
                    <span>@(isAr ? "صفقات" : "Deals")</span>
                </a>
            </div>
        </div>
    </section>
}

<!-- 3. Featured Products -->
<section id="products" class="products-section">
    <div class="container">
        <div class="section-header">
            <h3>@(isAr ? "أحدث المنتجات" : "New Arrivals")</h3>
            <a href="#" class="view-all">@(isAr ? "عرض الكل" : "View All") <i class="fas fa-arrow-left"></i></a>
        </div>

        <div class="products-grid">
            @if (Model != null && Model.Any())
            {
                foreach (var item in Model)
                {
                    <div class="product-card" data-id="@item.Id" data-stock="@item.StockQuantity">

                        <!-- خصم -->
                        @if (item.OldPrice.HasValue && item.OldPrice > item.Price)
                        {
                            <span class="flash-badge"><i class="fas fa-bolt"></i> @(isAr ? "خصم" : "Sale")</span>
                        }

                        <!-- زر المفضلة -->
                        <button class="fav-btn" onclick="toggleWishlist(@item.Id, this)"><i class="far fa-heart"></i></button>

                        <div class="product-img">
                            <a asp-controller="Product" asp-action="Details" asp-route-id="@item.Id">
                                <img src="~/@item.ImageUrl" alt="@item.Name" onerror="this.src='https://placehold.co/200x200?text=Product'">
                            </a>
                        </div>

                        <div class="product-info">
                            <a asp-controller="Product" asp-action="Details" asp-route-id="@item.Id" style="text-decoration:none; color:inherit;">
                                <h4>@(isAr? item.Name: (item.NameEn ?? item.Name))</h4>
                            </a>

                            <div class="pricing">
                                <span class="current-price">@item.Price.ToString("N2") @(isAr ? "ج.م" : "EGP")</span>
                                @if (item.OldPrice.HasValue)
                                {
                                    <span class="old-price">@item.OldPrice.Value.ToString("N2")</span>
                                }
                                <span class="unit">/ @(isAr ? "قطعة" : "Unit")</span>
                            </div>

                            <div class="wholesale-info">
                                <i class="fas fa-box"></i> @(isAr ? $"كرتونة: {item.UnitsPerCarton} قطعة" : $"Carton: {item.UnitsPerCarton}")
                            </div>

                            <div class="add-to-cart">
                                <button class="add-btn btn primary w-100" onclick="addToCart(this)">
                                    @(isAr ? "إضافة للسلة" : "Add to Cart") <i class="fas fa-cart-plus"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                }
            }
            else
            {
                <div style="grid-column:1/-1; text-align:center; padding:40px; color:#777;">
                    <i class="fas fa-box-open fa-3x" style="margin-bottom:10px; opacity:0.5;"></i>
                    <p>@(isAr ? "لا توجد منتجات متاحة حالياً." : "No products available.")</p>
                </div>
            }
        </div>
    </div>
</section>

<!-- 4. Features/Trust Section -->
<section class="section-padding bg-light">
    <div class="container">
        <div class="stats-grid" style="grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));">
            <div class="stat-box" style="text-align:center;">
                <i class="fas fa-truck fa-2x" style="color:var(--primary); margin-bottom:15px;"></i>
                <h4>@(isAr ? "شحن لجميع المحافظات" : "Nationwide Shipping")</h4>
                <p style="font-size:0.9rem; color:#666;">@(isAr ? "توصيل سريع وآمن لباب محلك" : "Fast and secure delivery to your shop")</p>
            </div>
            <div class="stat-box" style="text-align:center;">
                <i class="fas fa-wallet fa-2x" style="color:var(--primary); margin-bottom:15px;"></i>
                <h4>@(isAr ? "دفع عند الاستلام" : "Cash on Delivery")</h4>
                <p style="font-size:0.9rem; color:#666;">@(isAr ? "افحص بضاعتك قبل ما تدفع" : "Inspect your goods before paying")</p>
            </div>
            <div class="stat-box" style="text-align:center;">
                <i class="fas fa-headset fa-2x" style="color:var(--primary); margin-bottom:15px;"></i>
                <h4>@(isAr ? "دعم فني 24/7" : "24/7 Support")</h4>
                <p style="font-size:0.9rem; color:#666;">@(isAr ? "فريق كامل لخدمتك في أي وقت" : "Full team ready to help you")</p>
            </div>
        </div>
    </div>
</section>