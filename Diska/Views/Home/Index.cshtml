@model IEnumerable<Diska.Models.Product>
@using System.Globalization
@{
    bool isAr = CultureInfo.CurrentCulture.Name.StartsWith("ar");
    ViewData["Title"] = isAr ? "الرئيسية" : "Home";

    // استقبال قائمة الأقسام من الكنترولر
    var categories = ViewBag.Categories as List<Diska.Models.Category>;

    // مصفوفة ألوان للخلفيات (للتنويع)
    string[] bgColors = { "#e3f2fd", "#ffebee", "#e8f5e9", "#fff3e0", "#f3e5f5" };
    string[] iconColors = { "#2196f3", "#f44336", "#4caf50", "#ff9800", "#9c27b0" };
}

<section class="hero-section">
    <div class="container">
        <div class="banner-card">
            <div class="banner-content">
                <div class="hero-brand-block">
                    <img src="~/images/ChatGPT_Image_22_ديسمبر_2025__12_14_35_ص-removebg-preview.png" alt="DISKA" class="hero-logo-img">
                    <span class="brand-slogan">@(isAr ? "سوق الجملة في جيبك" : "Wholesale in your pocket")</span>
                </div>

                <div class="tag-box">
                    <span class="tag">@(isAr ? "عروض متتفوتش 🔥" : "Hot Deals 🔥")</span>
                </div>

                <h2 class="main-headline">@(isAr ? "خصومات حصرية على جميع المنتجات" : "Exclusive Discounts on All Products")</h2>
                <p class="slogan-desc">@(isAr ? "أسهل طريقة لطلب بضاعة محلك، من المصنع إليك مباشرة بأرخص سعر." : "The easiest way to order stock for your shop, directly from factories at the best prices.")</p>

                <a asp-controller="Home" asp-action="Deals" class="btn primary">@(isAr ? "تصفح العروض" : "Browse Offers")</a>
            </div>

            <div class="banner-image">
                <img src="~/images/مشروبات.webp" alt="Offers">
            </div>
        </div>
    </div>
</section>

<!-- Categories Section (Dynamic Link Fix) -->
<section class="categories-section">
    <div class="container">
        <h3 class="section-title" style="margin-bottom:20px;">@(isAr ? "تسوق حسب الفئة" : "Shop by Category")</h3>
        <div class="categories-grid">

            @if (categories != null && categories.Any())
            {
                int i = 0;
                foreach (var cat in categories)
                {
                    // استخدام الألوان بالتناوب
                    var bg = bgColors[i % bgColors.Length];
                    var color = iconColors[i % iconColors.Length];
                    i++;

                    // الرابط يستخدم الآن الـ ID الحقيقي من قاعدة البيانات
                    <a asp-controller="Product" asp-action="Category" asp-route-id="@cat.Id" class="cat-item">
                        <div class="icon" style="background-color: @bg;">
                            <!-- استخدام الأيقونة المخزنة في الداتابيز أو أيقونة افتراضية -->
                            <i class="@(string.IsNullOrEmpty(cat.IconClass) ? "fas fa-box" : cat.IconClass)" style="color: @color;"></i>
                        </div>
                        <span>@(isAr? cat.Name: (cat.NameEn ?? cat.Name))</span>
                    </a>
                }
            }

            <!-- رابط ثابت للصفقات -->
            <a asp-controller="Home" asp-action="Deals" class="cat-item">
                <div class="icon" style="background-color: #fff3e0;"><i class="fas fa-fire" style="color: #ff9800;"></i></div>
                <span>@(isAr ? "عروض خاصة" : "Special Offers")</span>
            </a>

        </div>
    </div>
</section>

<section id="products" class="products-section bg-light">
    <div class="container">
        <div class="section-header">
            <h3>@(isAr ? "الأصناف في مكان واحد" : "All Items")</h3>
            <a href="#" class="view-all">@(isAr ? "عرض الكل" : "View All") <i class="@(isAr ? "fas fa-arrow-left" : "fas fa-arrow-right")"></i></a>
        </div>

        <div class="products-grid">
            @foreach (var item in Model)
            {
                <div class="product-card merchant-product" data-id="@item.Id" data-stock="@item.StockQuantity">
                    <button class="fav-btn"><i class="fas fa-heart"></i></button>
                    @if (item.OldPrice > item.Price)
                    {
                        <div class="flash-badge"><i class="fas fa-star"></i> @(isAr ? "خصم" : "Sale")</div>
                    }

                    <a asp-controller="Product" asp-action="Details" asp-route-id="@item.Id" style="text-decoration:none;">
                        <div class="product-img"><img src="~/@item.ImageUrl" alt="@item.Name"></div>
                    </a>

                    <div class="product-info">
                        <div class="in-cart-indicator"></div>

                        <a asp-controller="Product" asp-action="Details" asp-route-id="@item.Id" style="text-decoration:none; color:inherit;">
                            <h4>@(isAr? item.Name: (item.NameEn ?? item.Name))</h4>
                        </a>

                        <p class="product-desc-short">@item.Description</p>

                        <div class="product-meta">
                            <span><i class="fas fa-box-open"></i> @item.UnitsPerCarton / @(isAr ? "كرتونة" : "Carton")</span>
                            <span class="stock-info">@(isAr ? "متاح:" : "Stock:") @item.StockQuantity</span>
                        </div>

                        <div class="pricing">
                            <span class="current-price">@item.Price.ToString("F2") @(isAr ? "ج.م" : "EGP")</span>
                            @if (item.OldPrice.HasValue)
                            {
                                <span class="old-price">@item.OldPrice.Value.ToString("F2") @(isAr ? "ج.م" : "EGP")</span>
                            }
                        </div>

                        <div class="card-actions" style="display:flex; gap:10px; margin-top:10px;">
                            <div class="qty-control-card" style="display:flex; border:1px solid #ddd; border-radius:5px;">
                                <button class="card-minus" style="border:none; background:#eee; width:30px; cursor:pointer;">-</button>
                                <input type="number" class="manual-qty" value="1" min="1" max="@item.StockQuantity" style="width:50px; text-align:center; border:none; font-weight:bold;">
                                <button class="card-plus" style="border:none; background:#eee; width:30px; cursor:pointer;">+</button>
                            </div>
                            <button class="add-btn" style="flex:1; border:none; background:var(--primary); color:#fff; border-radius:5px; cursor:pointer;">
                                @(isAr ? "أضف" : "Add") <i class="fas fa-cart-plus"></i>
                            </button>
                        </div>
                    </div>
                </div>
            }
        </div>
    </div>
</section>