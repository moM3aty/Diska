@model IEnumerable<Diska.Models.WishlistItem>
@using System.Globalization
@{
    bool isAr = CultureInfo.CurrentCulture.Name.StartsWith("ar");
    ViewData["Title"] = isAr ? "المفضلة" : "Wishlist";
    Layout = "_Layout";
}

<section class="section-padding" style="min-height: 70vh;">
    <div class="container">

        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:30px;">
            <h2 class="page-title" style="margin:0;">@(isAr ? "المنتجات المفضلة ❤️" : "My Wishlist ❤️")</h2>
            <a asp-controller="Home" asp-action="Index" class="btn btn-outline-primary small">
                <i class="fas fa-plus"></i> @(isAr ? "تصفح المزيد" : "Browse More")
            </a>
        </div>

        @if (!Model.Any())
        {
            <div style="text-align:center; padding:80px; background:#fff; border-radius:16px; border:1px solid #eee;">
                <i class="far fa-heart fa-4x" style="color:#e2e8f0; margin-bottom:20px;"></i>
                <h3 style="color:#64748b;">@(isAr ? "قائمة المفضلة فارغة." : "Your wishlist is empty.")</h3>
                <p style="color:#999; margin-bottom:20px;">@(isAr ? "احفظ المنتجات التي تعجبك هنا للوصول إليها لاحقاً." : "Save items you like here for later.")</p>
                <a asp-controller="Home" asp-action="Index" class="btn primary small">
                    @(isAr ? "ابدأ التسوق" : "Start Shopping")
                </a>
            </div>
        }
        else
        {
            <div class="products-grid">
                @foreach (var item in Model)
                {
                    <div class="product-card" data-id="@item.Product.Id">

                        <!-- زر الحذف -->
                        <form asp-action="Remove" method="post" style="position:absolute; top:15px; @(isAr?"left":"right"):15px; z-index:10;">
                            <input type="hidden" name="id" value="@item.Id" />
                            <button type="submit" class="btn" style="background:#fee2e2; color:red; border-radius:50%; width:35px; height:35px; padding:0; display:flex; align-items:center; justify-content:center; border:none; cursor:pointer; box-shadow:0 2px 5px rgba(0,0,0,0.1);" title="@(isAr ? "إزالة" : "Remove")">
                                <i class="fas fa-times"></i>
                            </button>
                        </form>

                        @if (item.Product.OldPrice.HasValue && item.Product.OldPrice > item.Product.Price)
                        {
                            <div class="flash-badge">@(isAr ? "خصم" : "Sale")</div>
                        }

                        <a asp-controller="Product" asp-action="Details" asp-route-id="@item.Product.Id" class="product-img">
                            <img src="~/@item.Product.ImageUrl" alt="@item.Product.Name" onerror="this.src='/images/default.png'">
                        </a>

                        <div class="product-info">
                            <span class="pro-cat" style="font-size:0.75rem; color:#64748b; display:block; margin-bottom:5px;">
                                @(isAr? item.Product.Category?.Name : item.Product.Category?.NameEn)
                            </span>

                            <a asp-controller="Product" asp-action="Details" asp-route-id="@item.Product.Id" style="text-decoration:none; color:inherit;">
                                <h4>@(isAr? item.Product.Name : (item.Product.NameEn ?? item.Product.Name))</h4>
                            </a>

                            <div class="pricing">
                                <span class="current-price">@item.Product.Price.ToString("N0") <small>@(isAr ? "ج.م" : "EGP")</small></span>
                                @if (item.Product.OldPrice.HasValue)
                                {
                                    <span class="old-price">@item.Product.OldPrice.Value.ToString("N0")</span>
                                }
                            </div>

                            <div class="product-meta">
                                <span class="@(item.Product.StockQuantity > 0 ? "stock-info" : "stock-info low")">
                                    @(item.Product.StockQuantity > 0 ? (isAr ? "متوفر" : "In Stock") : (isAr ? "غير متوفر" : "Out of Stock"))
                                </span>
                            </div>

                            <div class="add-to-cart" style="margin-top:10px;">
                                @if (item.Product.StockQuantity > 0)
                                {
                                    <button class="add-btn" onclick="addToCartSimple(@item.Product.Id)" style="width:100%; display:flex; align-items:center; justify-content:center; gap:5px;">
                                        @(isAr ? "إضافة للسلة" : "Add to Cart") <i class="fas fa-cart-plus"></i>
                                    </button>
                                }
                                else
                                {
                                    <button class="add-btn" disabled style="width:100%; background:#ccc; cursor:not-allowed;">
                                        @(isAr ? "نفذت الكمية" : "Out of Stock")
                                    </button>
                                }
                            </div>
                        </div>
                    </div>
                }
            </div>
        }
    </div>
</section>

@section Scripts {
    <script src="~/js/cart.js"></script>
    <script>
        function addToCartSimple(id) {
            if(typeof addItemToCart === 'function') {
                addItemToCart(id, 1);
            }
        }
    </script>
}