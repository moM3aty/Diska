@model IEnumerable<Diska.Models.DealRequest>
@using System.Globalization
@{
    bool isAr = CultureInfo.CurrentCulture.Name.StartsWith("ar");
    ViewData["Title"] = isAr ? "طلباتي الخاصة" : "My Requests";
    Layout = "_Layout";
}

<section class="section-padding">
    <div class="container">

        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:30px;">
            <div>
                <h2 class="page-title" style="margin:0;">@(isAr ? "طلبات الشراء الخاصة" : "Special Requests") 📢</h2>
                <p style="color:#666; margin-top:5px;">@(isAr ? "اطلب كميات خاصة أو منتجات غير متوفرة" : "Request bulk items or unavailable products")</p>
            </div>
            <a asp-action="Create" class="btn primary small">
                <i class="fas fa-plus"></i> @(isAr ? "طلب جديد" : "New Request")
            </a>
        </div>

        @if (TempData["Success"] != null)
        {
            <div style="background:#dcfce7; color:#166534; padding:15px; border-radius:8px; margin-bottom:20px; border:1px solid #bbf7d0;">
                <i class="fas fa-check-circle"></i> @TempData["Success"]
            </div>
        }

        @if (!Model.Any())
        {
            <div style="text-align:center; padding:60px; background:#fff; border-radius:15px; border:1px solid #eee;">
                <i class="fas fa-bullhorn fa-4x" style="color:#e2e8f0; margin-bottom:20px;"></i>
                <h3 style="color:#64748b;">@(isAr ? "ليس لديك طلبات خاصة حالياً." : "No requests yet.")</h3>
                <a asp-action="Create" class="btn primary small" style="margin-top:20px;">
                    @(isAr ? "أضف طلبك الأول" : "Create First Request")
                </a>
            </div>
        }
        else
        {
            <div style="display:grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap:25px;">
                @foreach (var item in Model)
                {
                    <div class="card" style="background:#fff; border:1px solid #e2e8f0; border-radius:12px; padding:20px; position:relative; transition:0.3s; box-shadow:0 2px 5px rgba(0,0,0,0.02);">

                        <div style="display:flex; justify-content:space-between; margin-bottom:10px;">
                            @{
                                var statusClass = item.Status switch
                                {
                                    "Pending" => "bg-warning text-dark",
                                    "Approved" => "bg-info text-white",
                                    "Completed" => "bg-success text-white",
                                    "Rejected" => "bg-danger text-white",
                                    _ => "bg-secondary text-white"
                                };
                                var statusText = isAr ? (item.Status == "Pending" ? "قيد المراجعة" : item.Status == "Approved" ? "مقبول/مفتوح" : item.Status == "Completed" ? "مكتمل" : "مرفوض") : item.Status;
                            }
                            <span class="badge @statusClass" style="padding:5px 10px; border-radius:15px; font-size:0.75rem;">@statusText</span>
                            <small style="color:#999;">@item.RequestDate.ToString("dd/MM/yyyy")</small>
                        </div>

                        <h4 style="margin:0 0 10px; color:var(--primary); font-size:1.1rem;">@item.ProductName</h4>

                        <div style="font-size:0.9rem; color:#555; margin-bottom:15px;">
                            <p style="margin:0 0 5px;"><i class="fas fa-cubes text-muted"></i> @(isAr ? "الكمية:" : "Qty:") <strong>@item.TargetQuantity</strong></p>
                            <p style="margin:0 0 5px;"><i class="fas fa-tag text-muted"></i> @(isAr ? "السعر المستهدف:" : "Target Price:") <strong>@item.DealPrice.ToString("N0")</strong></p>
                            <p style="margin:0;"><i class="fas fa-map-marker-alt text-muted"></i> @item.Location</p>
                        </div>

                        @if (item.Offers != null && item.Offers.Any())
                        {
                            <div style="background:#f0f9ff; color:#0284c7; padding:8px; border-radius:6px; font-size:0.85rem; text-align:center; margin-bottom:15px;">
                                <i class="fas fa-bell"></i> @item.Offers.Count @(isAr ? "عروض جديدة!" : "New Offers!")
                            </div>
                        }

                        <div style="border-top:1px solid #eee; padding-top:15px; display:flex; justify-content:space-between; align-items:center;">
                            <a asp-action="Details" asp-route-id="@item.Id" class="btn primary small" style="padding:6px 15px; border-radius:6px;">
                                @(isAr ? "التفاصيل والعروض" : "Details & Offers")
                            </a>

                            @if (item.Status != "Completed")
                            {
                                <form asp-action="Delete" method="post" onsubmit="return confirm('@(isAr ? "حذف الطلب؟" : "Delete request?")');" style="margin:0;">
                                    <input type="hidden" name="id" value="@item.Id" />
                                    <button type="submit" class="btn small" style="background:transparent; color:#dc2626; border:none;">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </form>
                            }
                        </div>
                    </div>
                }
            </div>
        }
    </div>
</section>