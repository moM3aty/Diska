@model IEnumerable<Diska.Models.RestockSubscription>
@using System.Globalization
@{
    bool isAr = CultureInfo.CurrentCulture.Name.StartsWith("ar");
    ViewData["Title"] = isAr ? "طلبات التوفر" : "Restock Requests";
}

<section class="section-padding">
    <div class="container">
        <h2 class="page-title">@(isAr ? "عملاء ينتظرون التوفر" : "Customers Waiting for Stock") 🔔</h2>
        <p style="color:#666; margin-bottom:20px;">@(isAr ? "هذه القائمة توضح العملاء الذين طلبوا إشعارهم عند توفر منتجاتك النافذة." : "List of customers waiting for your out-of-stock products.")</p>

        @if (!Model.Any())
        {
            <div style="text-align:center; padding:50px; background:#fff; border-radius:10px; border:1px solid #eee;">
                <p style="color:#777;">@(isAr ? "لا توجد طلبات انتظار حالياً." : "No restock requests.")</p>
            </div>
        }
        else
        {
            <div class="table-responsive">
                <table class="table" style="width:100%; border-collapse:collapse; background:#fff; border-radius:10px; overflow:hidden; box-shadow:0 2px 10px rgba(0,0,0,0.05);">
                    <thead style="background:#f8fafc; color:#334155;">
                        <tr>
                            <th style="padding:15px;">@(isAr ? "المنتج" : "Product")</th>
                            <th style="padding:15px;">@(isAr ? "المخزون الحالي" : "Current Stock")</th>
                            <th style="padding:15px;">@(isAr ? "العميل (للإشعار)" : "Customer")</th>
                            <th style="padding:15px;">@(isAr ? "تاريخ الطلب" : "Request Date")</th>
                            <th style="padding:15px;">@(isAr ? "الإجراء" : "Action")</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var item in Model)
                        {
                            <tr style="border-bottom:1px solid #eee;">
                                <td style="padding:15px;">
                                    <div style="display:flex; align-items:center; gap:10px;">
                                        <img src="~/@item.Product?.ImageUrl" style="width:40px; height:40px; object-fit:contain; border-radius:5px;">
                                        <strong>@item.Product?.Name</strong>
                                    </div>
                                </td>
                                <td style="padding:15px; font-weight:bold; color:@(item.Product.StockQuantity > 0 ? "green" : "red");">
                                    @item.Product.StockQuantity
                                </td>
                                <td style="padding:15px;">@(item.UserId ?? item.Email)</td>
                                <td style="padding:15px; color:#666; font-size:0.9rem;">@item.RequestDate.ToString("dd/MM/yyyy")</td>
                                <td style="padding:15px;">
                                    @if (item.Product.StockQuantity > 0)
                                    {
                                        <form asp-action="MarkRestocked" method="post">
                                            <input type="hidden" name="id" value="@item.Id" />
                                            <button type="submit" class="btn primary small">@(isAr ? "تم الإشعار" : "Mark Notified")</button>
                                        </form>
                                    }
                                    else
                                    {
                                        <span class="badge" style="background:#fee2e2; color:#b91c1c;">@(isAr ? "وفر الكمية أولاً" : "Restock First")</span>
                                    }
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        }
    </div>
</section>