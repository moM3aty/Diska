@model IEnumerable<Diska.Models.Product>
@{
    ViewData["Title"] = "لوحة تحكم التاجر";
}

<section class="section-padding">
    <div class="container">
        <!-- Dashboard Stats -->
        <div class="stats-grid" style="grid-template-columns: repeat(3, 1fr); gap: 20px; margin-bottom: 30px;">
            <div class="stat-box" style="background:#e0f2fe; border-left:5px solid #0284c7;">
                <h3 style="color:#0284c7;">@ViewBag.TotalProducts</h3>
                <p>إجمالي المنتجات</p>
            </div>
            <div class="stat-box" style="background:#fef2f2; border-left:5px solid #dc2626;">
                <h3 style="color:#dc2626;">@ViewBag.LowStock</h3>
                <p>منتجات توشك على النفاد</p>
            </div>
            <div class="stat-box" style="background:#f0fdf4; border-left:5px solid #16a34a;">
                <h3 style="color:#16a34a;">@string.Format("{0:N0}", ViewBag.TotalValue) ج.م</h3>
                <p>قيمة المخزون</p>
            </div>
        </div>

        <div class="merchant-grid">
            <div class="merchant-form-box" style="width:100%;">
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
                    <h2 style="color: var(--primary);">منتجاتي</h2>
                    <a asp-action="ProductForm" class="btn primary"><i class="fas fa-plus"></i> إضافة منتج جديد</a>
                </div>

                @if (!Model.Any())
                {
                    <div style="text-align:center; padding:40px; color:#777;">
                        <i class="fas fa-box-open fa-3x" style="margin-bottom:10px;"></i>
                        <p>لم تقم بإضافة أي منتجات بعد.</p>
                    </div>
                }
                else
                {
                    <div class="table-responsive">
                        <table class="table" style="width:100%; text-align:center; border-collapse:collapse;">
                            <thead>
                                <tr style="background:#f8fafc; color:#64748b;">
                                    <th style="padding:15px;">المنتج</th>
                                    <th>السعر</th>
                                    <th>المخزون</th>
                                    <th>الصلاحية</th>
                                    <th>الإجراءات</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var item in Model)
                                {
                                    <tr style="border-bottom:1px solid #eee;">
                                        <td style="padding:15px; display:flex; align-items:center; gap:10px;">
                                            <img src="~/@item.ImageUrl" style="width:50px; height:50px; object-fit:contain; border-radius:5px; border:1px solid #eee;">
                                            <div style="text-align:right;">
                                                <div style="font-weight:bold;">@item.Name</div>
                                                <small style="color:#999;">@item.Category?.Name</small>
                                            </div>
                                        </td>
                                        <td>@item.Price.ToString("N2")</td>
                                        <td>
                                            @if (item.StockQuantity == 0)
                                            {
                                                <span style="color:red; font-weight:bold;">نفذت</span>
                                            }
                                            else if (item.StockQuantity < 10)
                                            {
                                                <span style="color:orange;">@item.StockQuantity (منخفض)</span>
                                            }
                                            else
                                            {
                                                <span style="color:green;">@item.StockQuantity</span>
                                            }
                                        </td>
                                        <td>
                                            @if (item.IsExpired)
                                            {
                                                <span style="background:#fee2e2; color:red; padding:3px 8px; border-radius:4px; font-size:0.8rem;">منتهي</span>
                                            }
                                            else
                                            {
                                                <span style="font-size:0.9rem;">@item.ExpiryDate?.ToString("dd/MM/yyyy")</span>
                                            }
                                        </td>
                                        <td>
                                            <!-- زر تفعيل/إيقاف المنتج -->
                                            <form asp-action="ToggleStatus" method="post" style="display:inline;">
                                                <input type="hidden" name="id" value="@item.Id" />
                                                <button type="submit" class="btn small" style="background:@(item.IsActive ? "#dcfce7" : "#fee2e2"); color:@(item.IsActive ? "#166534" : "#b91c1c"); border:none; padding:5px 10px; border-radius:5px;" title="@(item.IsActive ? "إخفاء المنتج" : "إظهار المنتج")">
                                                    <i class="fas @(item.IsActive ? "fa-eye" : "fa-eye-slash")"></i>
                                                </button>
                                            </form>

                                            <a asp-action="ProductForm" asp-route-id="@item.Id" class="btn-edit" title="تعديل"><i class="fas fa-edit"></i></a>

                                            <form asp-action="Delete" method="post" style="display:inline;" onsubmit="return confirm('هل أنت متأكد من حذف هذا المنتج؟');">
                                                <input type="hidden" name="id" value="@item.Id" />
                                                <button type="submit" class="btn-delete" title="حذف"><i class="fas fa-trash"></i></button>
                                            </form>
                                        </td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                }
            </div>
        </div>
    </div>
</section>