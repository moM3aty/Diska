@model Diska.Models.Order
@using System.Globalization
@{
    bool isAr = CultureInfo.CurrentCulture.Name.StartsWith("ar");
    Layout = null; // لا نستخدم Layout ليكون الملف نظيف للطباعة
    var dir = isAr ? "rtl" : "ltr";
}

<!DOCTYPE html>
<html lang="@(isAr ? "ar" : "en")" dir="@dir">
<head>
    <meta charset="UTF-8">
    <title>Invoice #@Model.Id</title>
    <!-- استدعاء Bootstrap للطباعة -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.@(isAr ? "rtl." : "")min.css">

    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #fff;
            padding: 40px;
        }

        .invoice-box {
            max-width: 800px;
            margin: auto;
            border: 1px solid #eee;
            padding: 30px;
        }

        .invoice-title {
            font-size: 2.5rem;
            font-weight: bold;
            color: #333;
        }

        .invoice-meta {
            margin-bottom: 40px;
        }

        .table th {
            background-color: #f8f9fa !important;
        }

        @* إخفاء الأزرار عند الطباعة *@
        @("@media print { .no-print { display: none; } } ")
    </style>
</head>
<body onload="window.print()">

    <div class="text-center no-print mb-4">
        <button onclick="window.print()" class="btn btn-primary">Print / Save as PDF</button>
        <button onclick="window.close()" class="btn btn-secondary">Close</button>
    </div>

    <div class="invoice-box">
        <!-- Header -->
        <div class="row mb-5">
            <div class="col-6">
                <h1 class="invoice-title">INVOICE</h1>
                <p><strong>#INV-@Model.Id.ToString("D5")</strong></p>
            </div>
            <div class="col-6 text-end">
                <h3>DISKA B2B</h3>
                <p>Cairo, Egypt<br>Tax ID: 123-456-789</p>
            </div>
        </div>

        <!-- Info -->
        <div class="row invoice-meta mb-4">
            <div class="col-6">
                <h6 class="text-muted">BILL TO:</h6>
                <h5>@Model.CustomerName</h5>
                <div>@Model.Address</div>
                <div>@Model.City, @Model.Governorate</div>
                <div>@Model.Phone</div>
            </div>
            <div class="col-6 text-end">
                <h6 class="text-muted">DATE:</h6>
                <h5>@Model.OrderDate.ToString("dd MMM yyyy")</h5>
                <h6 class="text-muted mt-3">STATUS:</h6>
                <span class="badge bg-success border text-dark bg-opacity-25">PAID</span>
            </div>
        </div>

        <!-- Items -->
        <table class="table table-striped table-bordered">
            <thead>
                <tr>
                    <th>Item</th>
                    <th class="text-center">Qty</th>
                    <th class="text-end">Price</th>
                    <th class="text-end">Total</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in Model.OrderItems)
                {
                    <tr>
                        <td>
                            @(isAr? item.Product?.Name : item.Product?.NameEn)
                            <br><small class="text-muted">@item.Product?.SKU</small>
                        </td>
                        <td class="text-center">@item.Quantity</td>
                        <td class="text-end">@item.UnitPrice.ToString("N2")</td>
                        <td class="text-end">@((item.Quantity * item.UnitPrice).ToString("N2"))</td>
                    </tr>
                }
            </tbody>
        </table>

        <!-- Totals -->
        <div class="row justify-content-end mt-4">
            <div class="col-5">
                <table class="table table-borderless table-sm">
                    <tr>
                        <td>Subtotal:</td>
                        <td class="text-end">@((Model.TotalAmount - Model.ShippingCost).ToString("N2"))</td>
                    </tr>
                    <tr>
                        <td>Shipping:</td>
                        <td class="text-end">@Model.ShippingCost.ToString("N2")</td>
                    </tr>
                    <tr class="border-top">
                        <td class="fs-5 fw-bold">Total:</td>
                        <td class="text-end fs-5 fw-bold">@Model.TotalAmount.ToString("N2") EGP</td>
                    </tr>
                </table>
            </div>
        </div>

        <!-- Footer -->
        <div class="mt-5 pt-4 border-top text-center text-muted small">
            <p>Thank you for your business.</p>
        </div>
    </div>

</body>
</html>